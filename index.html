<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>北立交桥·冬日之家直播状态监控</title>
  <meta name="description" content="实时监控北立交桥·冬日之家旗下主播的直播状态" />
  <meta name="keywords" content="北立交桥,冬日之家,直播状态,直播监控,Bilibili直播" />
  <link rel="stylesheet" href="/css/index.css" />
  <link rel="stylesheet" href="/css/SystemNotice.css" />
  <link rel="icon" href="/winter-home.png" />

  <!-- Open Graph 元标签 -->
  <meta property="og:title" content="北立交桥·冬日之家直播监控" />
  <meta property="og:description" content="实时监控北立交桥·冬日之家旗下主播的直播状态" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://whome.yangdujun.top" />
  <meta property="og:image" content="https://whome.yangdujun.top/winter-home.png" />

  <!-- Canonical URL -->
  <link rel="canonical" href="https://whome.yangdujun.top" />
</head>

<body>
  <header>
    <h1>北立交桥·冬日之家直播状态监控</h1>
    <div class="connection-status">
      <span class="status-dot"></span>
      <span class="status-text">数据加载中...</span>
    </div>
  </header>

  <main>
    <div class="filters">
      <input type="text" id="search" placeholder="搜索主播..." aria-label="搜索主播" />
      <select id="status-filter" aria-label="按状态筛选">
        <option value="all">全部状态</option>
        <option value="living">正在直播</option>
        <option value="offline">未直播</option>
      </select>
      <select id="sort-order">
        <option value="name_asc">名称A-Z</option>
        <option value="name_desc">名称Z-A</option>
        <option value="live_desc" selected >直播优先</option>
        <option value="live_asc">未直播优先</option>
      </select>
      <button id="refresh-btn" title="刷新数据" aria-label="刷新数据">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
          <path d="M3 3v5h5"></path>
          <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"></path>
          <path d="M16 16h5v5"></path>
        </svg>
      </button>
    </div>

    <div class="stats-bar">
      <span>主播总数: <span id="total-count">0</span></span>
      <span>正在直播: <span id="live-count">0</span></span>
      <span>未直播: <span id="offline-count">0</span></span>
    </div>

    <div class="streamers-container"></div>
  </main>

  <div id="fh-notice" class="fh-notice-container"></div>

  <footer>
    <div class="footer-content">
      <div class="footer-links">
        <a href="https://www.5840.live" target="_blank">北立交桥官网</a>
        <a href="https://space.bilibili.com/1240518940" target="_blank">北立交桥官方</a>
        <a href="https://live.bilibili.com/24375470" target="_blank">北立交桥官方直播间</a>
        <a href="https://www.yangdujun.top" target="_blank">开发者博客</a>
        <a href="https://www.yangdujun.top/opus/479" target="_blank">面板说明</a>
      </div>
      <div class="footer-disclaimer">
        <p>直播数据每5分钟自动刷新 | 最后更新: <span id="last-update">-</span></p>
        <p><a href="https://www.yangdujun.top/opus/479#数据更新说明" target="_blank">申请加入面板</a></p>
      </div>
    </div>
  </footer>

  <script type="module" src="/js/index.js"></script>
  <script type="module">
    import AnalyticsConsent from "https://cdn.yangdujun.top/js/ac.js";
    import { PingMonitor } from "https://cdn.yangdujun.top/js/ac.js"
    const pingMonitor = new PingMonitor();

    let customEventTriggered = false;

    document.addEventListener("DOMContentLoaded", function () {
      const analytics = new AnalyticsConsent({
        umamiUrl: "https://js.yangdujun.top/version.js",
        websiteId: "8735c089-ae7a-47c3-b2e2-65976c67e3b0",
        theme: "auto",
        onConsentChange: function (consent, isEUUser, source) {
          console.log(
            "用户选择:",
            consent ? "同意" : "拒绝",
            "来源:",
            source,
            "欧盟:",
            isEUUser
          );

          if (consent && !customEventTriggered) {
            customEventTriggered = true;
            sendConsentEvent(source, isEUUser);
          }
        },
      });
      function sendConsentEvent(source, isEUUser) {
        console.log("发送同意事件，包含标题信息");

        // 使用事件名称 + 事件数据的方式
        const eventData = {
          title: document.title, // 标题信息
          url: window.location.href,
          source: source, // 'default', 'saved', 'user'
          eu_user: isEUUser,
          language: navigator.language,
          referrer: document.referrer || "direct",
          time: new Date().toLocaleString("zh-CN"),
          usergent:navigator.userAgent
        };

        // 等待 umami 可用
        const waitForUmami = setInterval(() => {
          if (window.umami) {
            clearInterval(waitForUmami);
            pingMonitor.start();
            umami.track("consent_approved", eventData);
            console.log("✅ 同意事件已发送:", eventData);
          }
        }, 100);

        // 10秒超时
        setTimeout(() => clearInterval(waitForUmami), 10000);
      }
    });
  </script>
</body>
</html>